# Copyright (c) 2006 MacKichan Software, Inc.  All Rights Reserved.

DEPTH		= ../../../..
topsrcdir	= @top_srcdir@
srcdir		= @srcdir@
VPATH		= @srcdir@

include $(DEPTH)/config/autoconf.mk

MODULE = compute
MODULE_NAME = computeModule
LIBRARY_NAME = computelib_s
IS_COMPONENT = 1
EXPORT_LIBRARY = 1
LIBXUL_LIBRARY = 1
GRE_MODULE	= 1

MOZILLA_INTERNAL_API = 1
FORCE_STATIC_LIB = 1

MOZILLA_INTERNAL_API = 1

include $(topsrcdir)/config/config.mk

CPPSRCS =				\
  DefStore.cpp  \
  SNode.cpp \
  MRequest.cpp \
  MResult.cpp \
  PrefStor.cpp  \
  $(NULL)

REQUIRES = \
  string \
  xpcom \
  compute \
  $(NULL)



LOCAL_INCLUDES = -I$(srcdir)/../libtci	\
	-I$(srcdir)/../Engines	\
	-I$(srcdir)/../src \
	-I$(srcdir)/../public \
	$(NULL)

SupportFiles	:= \
	$(srcdir)/swfcns.mu \
	$(NULL)


MuPADlib	:= \
	$(srcdir)/../MuPAD/lib/lib.tar \
	$(srcdir)/../MuPAD/lib/lib.toc \
	$(srcdir)/../MuPAD/lib/sysinit.mu \
	$(NULL)

#Set platform
ifeq ($(OS_ARCH),WINNT)
  PLATFORM = win32
endif

ifeq ($(OS_ARCH),Darwin)
  PLATFORM = maci
endif

ifeq ($(OS_ARCH),Linux)
  PLATFORM = linux
endif

ifeq ($(OS_ARCH),WINNT)

MuPADlicense	:= $(srcdir)/../MuPAD/license/license
MuPADbin	:= $(wildcard $(srcdir)/../MuPAD/win32/bin/*) 
MuPADmod	:= $(wildcard $(srcdir)/../MuPAD/win32/modules/*) 
SupportFiles	+= \
	$(srcdir)/../MuPAD/win32/mupkernel.dll \
	$(NULL)
endif

ifeq ($(OS_ARCH),Darwin)
MuPADlicense:=  $(srcdir)/../MuPAD/maci64/com.sciface.www.MuPADPro402.plist
MuPADbin	:= $(srcdir)/../MuPAD/maci/libQtCore.4.dylib
MuPADbin64 := $(wildcard $(srcdir)/../MuPAD/maci64/bin/*)
MuPADcodelib := $(wildcard $(srcdir)/../MuPAD/maci64/lib/*)
MuPADmod	:= $(wildcard $(srcdir)/../MuPAD/maci64/modules/*) 
MuPADshare := $(wildcard) $(srcdir)/../MuPAD/share/*

endif

ifeq ($(OS_ARCH),Linux)
MuPADlicense	:= $(srcdir)/../MuPAD/license/license 
MuPADbin := $(wildcard $(srcdir)/../MuPAD/linux/bin/*) 
MuPADcodelib := $(wildcard $(srcdir)/../MuPAD/linux/lib/*) 
MuPADmod := $(wildcard $(srcdir)/../MuPAD/linux/modules/*) 

endif

ifeq ($(OS_ARCH),Darwin)
	Platform := maci64
endif

MuPADlicense	:= $(srcdir)/../MuPAD/license/license
MuPADbin		:= $(wildcard $(srcdir)/../MuPAD/$(Platform)/bin/*) 
MuPADlib		:= $(wildcard $(srcdir)/../MuPAD/lib/*) 
MuPADmod		:= $(wildcard $(srcdir)/../MuPAD/$(Platform)/modules/*) 
MuPADlibraries 	:= $(wildcard $(srcdir)/../MuPAD/$(Platform)/lib/*)

include $(topsrcdir)/config/rules.mk


export:: $(MuPADlib)
	$(INSTALL) $(MuPADlib) $(FINAL_TARGET)/MuPAD/share/lib

export:: $(MuPADmod)
	$(INSTALL) $(MuPADlicense) $(FINAL_TARGET)/MuPAD/license
	$(INSTALL) $(MuPADshare) $(FINAL_TARGET)/MuPAD/share
	$(INSTALL) $(MuPADmod) $(FINAL_TARGET)/MuPAD/$(PLATFORM)64/modules

ifeq ($(OS_ARCH),Darwin)
export:: $(MuPADbin)	
	$(INSTALL) $(MuPADbin) $(FINAL_TARGET)/../lib

else
export:: $(MuPADbin)	
	$(INSTALL) $(MuPADbin) $(FINAL_TARGET)/MuPAD/$(PLATFORM)/bin
	$(INSTALL) $(MuPADmod) $(FINAL_TARGET)/MuPAD/$(Platform)/modules

export:: $(MuPADlibraries)
	$(INSTALL) $(MuPADlibraries) $(FINAL_TARGET)/MuPAD/$(Platform)/lib
endif

ifeq ($(OS_ARCH),Darwin)
export:: $(MuPADbin64)
	$(INSTALL)  $(MuPADbin64) $(FINAL_TARGET)/MuPAD/$(PLATFORM)64/bin

export:: $(MuPADcodelib)
	$(INSTALL) $(MuPADcodelib) $(FINAL_TARGET)/MuPAD/$(PLATFORM)64/lib
endif


# 	$(INSTALL) $(MuPADlicense) $(FINAL_TARGET)/MuPAD/license
# 	$(INSTALL) $(SupportFiles) $(FINAL_TARGET)
# 	$(INSTALL) $(MuPADlinuxbin) $(FINAL_TARGET)/MuPAD/linux/bin
# 	$(INSTALL) $(MuPADlinuxlib) $(FINAL_TARGET)/MuPAD/linux/lib
# 	$(INSTALL) $(MuPADlinuxmod) $(FINAL_TARGET)/MuPAD/linux/modules
# endif

export:: $(MuPADbin)
	$(INSTALL) $(MuPADbin) $(FINAL_TARGET)/MuPAD/$(Platform)/bin

dump::
	echo $(MuPADlicense), $(MuPADbin), $(MuPADlib), $(MuPADmod), $(MuPADlibraries)


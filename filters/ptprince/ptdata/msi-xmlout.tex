\makeatletter

\def\msi@rfi#1#2{\def#1{\msitag{<requestimplementation>#2</requestimplementation>}}}


% This writes the css file my.css. 
% Do this at the end because it happens that we don't know what css are required. 
 
\def\msimakecss{
   \def\css{2}	  % the css output file
   \openout\css={css/my.css} %% the CSS style file for this document
   \write\css{@import url("resource://app/res/css/baselatex.css");}
   \write\css{@import url("resource://app/res/css/latex.css");}
   \write\css{\classcss}
   \closeout\css
}

\def\classcss{}

\msi@dollar=`\$

\def\msi@pass#1{\def#1{\msitag{<texb>#1</texb>}}}
\def\msi@pass@newline#1{\def#1{\br\msihmode\msitag{<texb>#1</texb>}}}
\def\msitexb#1{\msitag{<texb>#1</texb>}}


\msi@pass@newline{\@settodim}
\msi@pass@newline{\settoheight}
\msi@pass@newline{\settodepth}
\msi@pass@newline{\settowidth}


% \newcounter{#1}[#2]

\def\out@newcounterA#1{%
  \br\msitag{<texb>\newcounter{#1}</texb>}%   
}

\def\out@newcounterB#1[#2]{%                                                              
  \br\msitag{<texb>\newcounter{#1}[#2]</texb>}%
}


%% redefine these to produce output
\def\setcounter#1#2{%
    \expandafter\global\csname c@#1\endcsname#2\relax
    \br\msitag{<texb>\string\setcounter{#1}{#2}</texb>}}

\def\addtocounter#1#2{%
    \expandafter\global\advance\csname c@#1\endcsname #2\relax
    \out@addtocounter{#1}{#2}}


\msi@inline@proc={jbm}
\msi@display@proc{jbm}
\msi@everyrowstart{<tr>}
\msi@everyrowend{</tr>}
\msi@everycellstart{<td>}
\msi@everycellend{</td>}

\def\msi@stylesheets{\msitag{<?xml-stylesheet href="css/my.css" type="text/css"?>}\br}


\def\@brace#1{\char123\relax#1\char125\relax}

\def\br{\char10}


%% \documentclass.  
  
\def\out@documentclassA[#1]#2{%
   \msi@opendocument
   \br\msitag{<documentclass class="#2" options="#1"/>}%
}

\def\out@documentclassB#1{%
   \msi@opendocument
   \br\msitag{<documentclass class="#1"/>}%
}


%% \document and \enddocument

\def\out@begin@document{%
   \msiclosetag{preamble}{</preamble>}%
   \br\msitag{</head>}
   \br\msiopentag{body}{<body>}
   %%\msihmode\br\msiopentag{docbody}{<docbody>}%
   \@paragraphs
   \msivmode
}

\def\out@end@document{%
   %%\br\msiclosetag{docbody}{</docbody>}%
   \br\msiclosetag{body}{</body>}
   \br\msitag{</html>}%
   \msimakecss
   \endinput
}


%% \usepackage
\def\out@usepackageA[#1]#2{%
   \br\msitag{<usepackage package="#2" options="#1"/>}%
}
\def\out@usepackageB#1{%
   \br\msitag{<usepackage package="#1"/>}%
}


%% Frontmatter

\def\out@frontmatter{%
   \msihmode\br\msitag{<frontmatter />}%
}

\def\out@title#1{%
   {\everypar={}\msitag{^^0a}\msiopentag{title}{<title>}#1\msiclosetag{title}{</title>}}}
   
\def\out@author#1{%
  \begingroup
   \def\\{\msitag{^^0a}\msiopentag{address}{<address>}\ignorespaces}%
   \def\and{\msiclosetag{author}{</author>}\msitag{^^0a}\msiopentag{author}{<author>}}%
   \msitag{^^0a}\msiopentag{author}{<author>}#1\msiclosetag{author}{</author>}%
  \endgroup
}

\def\out@date#1{%
   \msihmode\br\msiopentag{date}{<date>}#1\msiclosetag{date}{</date>}}

\def\out@maketitle{%
   \msihmode\br\msitag{<maketitle />}%
}
\def\out@tableofcontents{%
   \msihmode\br\msitag{<tableofcontents />}%
}
\def\out@listoffigures{%
   \msihmode\br\msitag{<listoffigures />}%
}
\def\out@listoftables{%
   \msihmode\br\msitag{<listoftables />}%
}

\def\out@thanks#1{%
   \msitag{^^0a}\msiopentag{thanks}{<thanks>}#1\msiclosetag{thanks}{</thanks>}}


\def\out@begin@abstract{%
   \msitag{^^0a}\msiopentag{abstract}{<abstract>}
}

\def\out@end@abstract{%
   \msitag{^^0a}\msiclosetag{abstract}{</abstract>}
}

%% Main matter

\def\out@mainmatter{%
   \msihmode\br\msitag{<mainmatter />}%
}

%% newtheorem

\def\out@newtheorema#1[#2]#3{%
   \br\msitag{<newtheorem name="#1" counter="#2" label="#3"/>}%
   \@namedef{msi@begin@#1}{\br\msiopentag{theorem}{<theorem type="#1">}}
   \@namedef{msi@end@#1}{\br\msiclosetag{theorem}{</theorem>}}
}

\def\out@newtheoremb#1#2{%
   \br\msitag{<newtheorem name="#1" label="#2"/>}%
   \@namedef{msi@begin@#1}{\br\msiopentag{theorem}{<theorem type="#1">}}
   \@namedef{msi@end@#1}{\br\msiclosetag{theorem}{</theorem>}}
}



% Two forms of the \newenvironment command



\def\@declarenewenva#1[#2][#3]#4#5{%
   \br\msitag{<newenvironment name="#1" nargs="#2" opt="#3" start="#4" end="#5" />}
}
\def\@declarenewenvb#1#2#3{%
   \br\msitag{<newenvironment name="#1" start="#4" end="#5" />}
}



%% Citations and cross refs


\def\out@citex[#1]#2{\msiopentag{cite}{<cite>}#2\msiclosetag{cite}{</cite>}}
\def\out@citey#1{\msiopentag{cite}{<cite>}#1\msiclosetag{cite}{</cite>}}



\def\ref#1{\msiopentag{ref}{<a>}#1\msiclosetag{ref}{</a>}}
\def\pageref#1{\msiopentag{pageref}{<pageref>}#1\msiclosetag{pageref}{</pageref>}}
\def\pagenumbering#1{%
   \msiopentag{latexstyleb}{<latexstyleb>}%
      \msiopentag{styleprop}{<styleprop>}%
         page number style
      \msiclosetag{styleprop}{</styleprop>}%
      \msiopentag{styledata}{<styledata>}%
         #1
      \msiclosetag{styledata}{</styledata>}%
   \msiclosetag{latexstyleb}{</latexstyleb>}}


\def\msi@pass#1{\def#1{\msitag{#1}}}
\def\msi@mathmlpass#1{\def#1{\string#1\char32\relax}}

\newif\if@first@item


\def\out@itema[#1]{
   \if@first@item
     \@first@itemfalse
   \else
     \msiclosetag{item}{</item>}%
   \fi
   \br\msihmode\msiopentag{item}{<item>}
   \msitag{<explicit-item>}#1\msitag{</explicit-item>}%
}

\def\out@itemb{
   \if@first@item
     \@first@itemfalse
   \else
     \msiclosetag{item}{</item>}%
   \fi
   \br\msihmode\msiopentag{item}{<item>}%
}




\def\out@bibitemA[#1]#2{%
   \if@first@item
     \@first@itemfalse
   \else
     \msiclosetag{item}{</bibitem>}%
   \fi
   \br\msihmode\msiopentag{bibitem}{<bibitem label="#1" ref="#2">}
   \msitag{<explicit-item>}#1\msitag{</explicit-item>}%
}

\def\out@bibitemB#1{%
   \if@first@item
     \@first@itemfalse
   \else
     \msiclosetag{bibitem}{</bibitem>}%
   \fi
   \msitag{^^0a}\msiopentag{bibitem}{<bibitem ref="#1">}%
}


\def\@closeitem{\msiclosetag{li}{</li>}}
\def\@openitem{\msiopentag{li}{<li>}}

\def\msi@begin@enumerate{\everypar={}\msihmode\msitag{^^0a^^0a}\@first@itemtrue \msiopentag{enumerate}{<enumerate>}}
\def\msi@end@enumerate{\br\msiclosetag{enumerate}{</enumerate>}}

\def\msi@begin@itemize{\everypar={}\msihmode\msitag{^^0a^^0a}\@first@itemtrue\msiopentag{itemize}{<itemize>}}
\def\msi@end@itemize{\br\msiclosetag{itemize}{</itemize>}}

\def\msi@begin@description{\everypar={}\msihmode\msitag{^^0a^^0a}\@first@itemtrue\msiopentag{description}{<description>}}
\def\msi@end@description{\br\msiclosetag{description}{</description>}}

\def\msi@begin@thebibliography#1{%
  \everypar={}\msihmode\msitag{^^0a^^0a}\@first@itemtrue \msiopentag{thebibliography}{<thebibliography>}%
}

\def\msi@end@thebibliography{\br\msiclosetag{description}{</description>}}


\def\msi@thm@like#1{}


\def\msi@begin@quote{\br\msiopentag{quote}{<quote>}}
\def\msi@end@quote{\br\msiclosetag{quote}{</quote>}}

\def\msi@begin@quotation{\br\msiopentag{quotation}{<quotation>}}
\def\msi@end@quotation{\br\msiclosetag{quotation}{</quotation>}}

\def\msi@begin@center{\br\msiopentag{center}{<center>}}
\def\msi@end@center{\br\msiclosetag{center}{</center>}}

\def\msi@begin@flushleft{\br\msiopentag{flushleft}{<flushleft>}}
\def\msi@end@flushleft{\br\msiclosetag{flushleft}{</flushleft>}}

\def\msi@begin@flushright{\br\msiopentag{flushright}{<flushright>}}
\def\msi@end@flushright{\br\msiclosetag{flushright}{</flushright>}}


\def\msi@begin@subequations{\br\msiopentag{subequations}{<subequations>}}
\def\msi@end@subequations{\br\msiclosetag{subequations}{</subequations>}}




%\input msiframe.tex


\def\msi@begin@equation{$$}
\def\msi@end@endequation{$$}

\def\[#1\]{%
  \ %
  %%\temptoksa={\[#1\]}%
  %%\msiextproc{jbm}{\the\temptoksa}%
  \msiextproc{jbm}{\[#1\]}%
}



\newcount\seclevel
\seclevel=0

\newif\if@starred
\def\@gobble#1{}

\def\newsection#1#2#3#4{%
  \expandafter\newcount\csname#1number\endcsname
  \csname#1number\endcsname=0
  \expandafter\def\csname the#1\endcsname{#3}%
  \expandafter\def\csname #1\endcsname{%
     \@ifnextchar*{\@starredtrue\csname @#1\endcsname}%
                  {\@starredfalse\csname @#1\endcsname *}%
  }
  \expandafter\def\csname @#1\endcsname*{%
     \@ifnextchar[{\csname @@#1\endcsname}%
                  {\csname @@#1\endcsname[]}%
  }
  \expandafter\def\csname @@#1\endcsname[##1]##2{%
     \seclevel=#2%
     \expandafter\advance\csname #1number\endcsname by 1%
     \let\protect\relax
     \msiclosetag{#1}{</#1>}%
     \msitag{^^0a}\msiopentag{#1}{<#1>}%
     {\everypar={}\msitag{^^0a}\msiopentag{#4}{<#4>}##2\msiclosetag{#4}{</#4>}}
  }%
}


\newsection{part}{1}{Part \the\partnumber}{sectiontitle}%
\newsection{chapter}{1}{Chapter \the\chapternumber}{sectiontitle}%

\def\out@marginparA#1#2{%
  \@start@notewrapper
  \msiopentag{note}{<note type="marginpar" opt="#1">}#2\msiclosetag{note}{</note>}%
  \@end@notewrapper
}

\def\out@marginparB#1{%
  \@start@notewrapper
  \msiopentag{note}{<note type="marginpar">}#1\msiclosetag{note}{</note>}%
  \@end@notewrapper
}

\def\rule{%
  \@ifnextchar[{\@rule}{\@rule[0pt]}%
}
\def\@rule[#1]#2#3{%
   \ifmmode
      \string\rule[#1]\char123#2\char125\char123#3\char125
   \else
      \msitag{<rule width="#2" height="#3" depth="#1"/>}%
   \fi
}


\def\hspace{%
   \@ifnextchar*{\@hspacestar}{\@hspace}}

\def\@hspace#1{   
   \ifmmode
     \string\hspace\@brace{#1}%
   \else
     \msitag{<hspace dim="#1" type="customSpace"></hspace>}%
   \fi
}

\def\@hspacestar#1#2{
   \@hspace{#2}%
}

\def\@paragraphs{%
  \let\@par\par
  \def\par{\msiclosetag{para}{</para>}\@par}%
  \everypar{\msihmode\br\msiopentag{para}{<para>}}%
}


\everymath{%
   \aftergroup\endmath
}
\def\endmath{}

\everydisplay{%
  \aftergroup\enddisplay
}
\def\enddisplay{}


\def\@make@braces@other{%
  \catcode`\{=12%
  \catcode`\}=12%
  \relax
}
\def\@make@braces@normal{%
  \catcode`\{=1%
  \catcode`\}=2%
  \relax
}

\bgroup
  \catcode`\^^M=13\relax
  \gdef^^M{\char13\char10\relax}%
\egroup


%  \def\@make@linebreak@other{%
%    \catcode`\^^M=13\relax
%  }
%  
%  \def\@make@linebreak@normal{%
%    \catcode`\^^M=5\relax
%  }

\newtoks\temptoksa

\bgroup
  \@make@braces@other
  \catcode`\[=1
  \catcode`\]=2
  \gdef\@scan@eqnarray@star#1\end{eqnarray*}[%
     \egroup
     \@make@braces@normal
     \msiopentag[mml][<mml:math class="displayedmathml" mode="display" display="block">]%
     \msiextproc[jbm][\begin{eqnarray*}#1\end{eqnarray*}]%
     \msiclosetag[mml][</mml:math>]
  ]
  \gdef\@scan@eqnarray#1\end{eqnarray}[%
     \egroup
     \@make@braces@normal
     \msiopentag[mml][<mml:math class="displayedmathml" mode="display" display="block">]%
     \msiextproc[jbm][\begin{eqnarray}#1\end{eqnarray}]%
     \msiclosetag[mml][</mml:math>]
  ]
  \gdef\@scan@align@star#1\end{align*}[%
     \egroup
     \@make@braces@normal
     \msiopentag[mml][<mml:math class="displayedmathml" mode="display" display="block">]%
     \msiextproc[jbm][\begin{align*}#1\end{align*}]%
     \msiclosetag[mml][</mml:math>]
  ]  
  \gdef\@scan@equation@star#1\end{equation*}[%
     \egroup
     \@make@braces@normal
     \msiopentag[mml][<mml:math class="displayedmathml" mode="display" display="block">]%
     \msiextproc[jbm][\begin{equation*}#1\end{equation*}]%
     \msiclosetag[mml][</mml:math>]
  ]
  \gdef\msi@mtabular#1#2\end{tabular}[%
     \egroup
     \@make@braces@normal
     \msitag[\begin{tabular}{#1}#2\end{tabular}]
  ]
  \gdef\@scan@array#1\end{array}[%
     \egroup
     \@make@braces@normal
     \msitag[\begin{array}#1\end{array}]
  ]
  \def\endarray[\cr\egroup\string\end`\{array\char`\}]
  \gdef\@scan@bmatrix#1\end{bmatrix}[%
     \egroup
     \@make@braces@normal
     \msitag[\begin{bmatrix}#1\end{bmatrix}]
     %\temptoksa=[\begin{bmatrix}#1\end{bmatrix}]%
     %\the\temptoksa
  ]
  \gdef\@scan@Bmatrix#1\end{Bmatrix}[%
     \egroup
     \@make@braces@normal
     \msitag[\begin{Bmatrix}#1\end{Bmatrix}]
     %\temptoksa=[\begin{Bmatrix}#1\end{Bmatrix}]%
     %\the\temptoksa
  ]
  \gdef\@scan@vmatrix#1\end{vmatrix}[%
     \egroup
     \@make@braces@normal
     \msitag[\begin{vmatrix}#1\end{vmatrix}]
     %\temptoksa=[\begin{vmatrix}#1\end{vmatrix}]%
     %\the\temptoksa
  ]
  \gdef\@scan@Vmatrix#1\end{Vmatrix}[%
     \egroup
     \@make@braces@normal
     \msitag[\begin{Vmatrix}#1\end{Vmatrix}]
     %\temptoksa=[\begin{Vmatrix}#1\end{Vmatrix}]%
     %\the\temptoksa
  ]
  \gdef\@scan@pmatrix#1\end{pmatrix}[%
     \egroup
     \@make@braces@normal
     \msitag[\begin{pmatrix}#1\end{pmatrix}]
     %\temptoksa=[\begin{pmatrix}#1\end{pmatrix}]%
     %\the\temptoksa
  ]
\egroup

\@namedef{msi@begin@eqnarray*}{\ \@make@braces@other\relax\@scan@eqnarray@star}
\@namedef{msi@begin@eqnarray}{\ \@make@braces@other\relax\@scan@eqnarray}

\@namedef{msi@begin@align*}{\ \@make@braces@other\relax\@scan@align@star}

\@namedef{msi@begin@equation*}{\ \@make@braces@other\relax\@scan@equation@star}
\def\msi@begin@array{\ \@make@braces@other\relax\@scan@array}

\def\msi@begin@bmatrix{\@make@braces@other\relax\@scan@bmatrix} 
\def\msi@begin@Bmatrix{\@make@braces@other\relax\@scan@Bmatrix} 
\def\msi@begin@vmatrix{\@make@braces@other\relax\@scan@vmatrix} 
\def\msi@begin@Vmatrix{\@make@braces@other\relax\@scan@Vmatrix} 
\def\msi@begin@pmatrix{\@make@braces@other\relax\@scan@pmatrix}



{\catcode`\^^M=\active % these lines must end with %
  \gdef\obeylines{\catcode`\^^M\active \let^^M\par}%
  \global\let^^M\par} % this is in case ^^M appears in a \write
\def\obeyspaces{\catcode`\ \active}
\def\space{ }
{\obeyspaces\global\let =\space}

 



\def\@cr{\@ifnextchar[{\@cra}{\@crb}}
\def\@cra[#1]{\cr}%
\def\@crb{\cr}%
\def\msi@begin@tabular{%
   \@ifnextchar[{\msi@begin@tabularA}{\msi@begin@tabularA[]}%
}


\def\msi@begin@tabularA[#1]#2{%
   \ifmmode
      \def\donext{\@make@braces@other\relax\msi@mtabular{#2}}%
   \else
      \def\donext{%
         \begingroup
            \msiopentag{tabular}{<tabular opt="#2">}%
            \aftergroup\msi@closetabular
            \hbox\bgroup
              \let\\=\@cr
              \halign\bgroup&####\cr
      }%
   \fi
   \donext
}

\def\msi@closetabular{\msiclosetag{tabular}{</tabular>}}

\def\msi@end@tabular{\crcr
     \egroup %halign
   \egroup   %hbox
 \endgroup   %donext
}

\def\cline#1{}
\def\hline{}
\def\multicolumn#1#2#3{%
   \count0=#1\relax
   \ifnum\count0=1
      #3
   \else
      \msitag{ Unimplemented multicol }
   \fi
}

\def\endbrace{\char`\}}
\chardef\other=12
\chardef\active=13
\bgroup
   \catcode`&=\active
   \gdef&{\char`&amp;}%
\egroup


\def\out@verbatim#1{%
  \br\msitag{<pre>}#1\msitag{</pre>}}

\def\verb{%
   \bgroup
      \catcode`\\=\other
      \catcode`{=\other
      \catcode`}=\other
      \catcode`&=\active
      \catcode`$=\other
      \msiopentag{verb}{<verb>}%
      \@sverb   
}
\def\verb@egroup{\msiclosetag{verb}{</verb>}\egroup}
\def\@sverb#1{%
  \catcode`#1\active
  \lccode`\~`#1\relax
  \lowercase{\let~\verb@egroup}%
}

\def\fbox#1{\ifmmode\temptoksa={#1}\string\fbox\char`\{\the\temptoksa\char`\}\fi}
\def\{{\char123\relax}
\def\}{\char125\relax}
\let\@hbox\hbox
\def\hbox{%
   \def\@after{}
   \ifmmode
      \string\hbox\char`\{\aftergroup\endbrace
   \else
      \def\@after{\@hbox}%
   \fi
   \@after
}


\def\mathbf#1{\string\mathbf\char123#1\char125}
\def\mathfrak#1{\string\mathfrak\char123#1\char125}

\def\LaTeX{<latex>LaTeX</latex>}
\def\TeX{<tex>TeX</tex>}
\def\textquotedblleft{<leftquote/>}
\def\textquotedblright{<rightquote/>}
\def\textbackslash{<textbackslash/>}

%% Back matter

\def\out@backmatter{%
   \msihmode\br\msitag{<backmatter />}%
}
\def\out@appendix{%
   \msihmode\br\msitag{<appendix />}%
}

%% 

\msi@mathmlpass{\dot}
\msi@mathmlpass{\boldsymbol}

\msi@mathmlpass{\allowbreak}
\msi@mathmlpass{\epsilon}
\msi@mathmlpass{\cup}
\msi@mathmlpass{\cap}

% Operators

\msi@mathmlpass{\int}
\msi@mathmlpass{\iint}
\msi@mathmlpass{\iiint}
\msi@mathmlpass{\iiiint}
\msi@mathmlpass{\idotsint}
\msi@mathmlpass{\oint}
\msi@mathmlpass{\sum}
\msi@mathmlpass{\prod}
\msi@mathmlpass{\bigcap}
\msi@mathmlpass{\bigwedge}
\msi@mathmlpass{\bigoplus}
\msi@mathmlpass{\bigodot}
\msi@mathmlpass{\bigsqcup}
\msi@mathmlpass{\coprod}
\msi@mathmlpass{\bigcup}
\msi@mathmlpass{\bigvee}
\msi@mathmlpass{\bigotimes}
\msi@mathmlpass{\biguplus}

\msi@mathmlpass{\nolimits}
\msi@mathmlpass{\dint}
\msi@mathmlpass{\diint}
\msi@mathmlpass{\diiint}
\msi@mathmlpass{\diiiint}
\msi@mathmlpass{\didotsint}
\msi@mathmlpass{\dbigwedge}
\msi@mathmlpass{\dbigoplus}
\msi@mathmlpass{\dbigodot}
\msi@mathmlpass{\dbigsqcup}
\msi@mathmlpass{\dcoprod}

\msi@mathmlpass{\doint}
\msi@mathmlpass{\dsum}
\msi@mathmlpass{\dprod}
\msi@mathmlpass{\dbigcap}
\msi@mathmlpass{\dbigcup}
\msi@mathmlpass{\dbigvee}
\msi@mathmlpass{\dbigotimes}
\msi@mathmlpass{\dbiguplus}
\msi@mathmlpass{\tint}
\msi@mathmlpass{\tiint}
\msi@mathmlpass{\tiiint}
\msi@mathmlpass{\tiiiint}
\msi@mathmlpass{\tidotsint}
\msi@mathmlpass{\tbigwedge}
\msi@mathmlpass{\tbigoplus}
\msi@mathmlpass{\tbigodot}
\msi@mathmlpass{\tbigsqcup}
\msi@mathmlpass{\tcoprod}
\msi@mathmlpass{\toint}
\msi@mathmlpass{\tsum}
\msi@mathmlpass{\tprod}
\msi@mathmlpass{\tbigcap}
\msi@mathmlpass{\tbigcup}
\msi@mathmlpass{\tbigvee}
\msi@mathmlpass{\tbigotimes}
\msi@mathmlpass{\tbiguplus}
\msi@mathmlpass{\gcd}
\msi@mathmlpass{\lcm}

\msi@mathmlpass{\infty}
\msi@mathmlpass{\neq}
\msi@mathmlpass{\leq}
\msi@mathmlpass{\geq}
\msi@mathmlpass{\det}

\msi@mathmlpass{\lfloor}
\msi@mathmlpass{\rfloor}
\msi@mathmlpass{\lceil}
\msi@mathmlpass{\rceil}

\msi@mathmlpass{\sin}
\msi@mathmlpass{\cos}
\msi@mathmlpass{\tan}
\msi@mathmlpass{\cot}
\msi@mathmlpass{\sec}
\msi@mathmlpass{\csc}

\msi@pass{\arcsin}
\msi@pass{\arccos}
\msi@pass{\arctan}


\msi@mathmlpass{\ln}

\msi@mathmlpass{\limits}
\msi@mathmlpass{\substack}
\msi@mathmlpass{\\}
\msi@mathmlpass{\arg}




% Lowercase Greek 
\msi@mathmlpass{\alpha}
\msi@mathmlpass{\beta}
\msi@mathmlpass{\chi}
\msi@mathmlpass{\delta}
\msi@mathmlpass{\eta}
\msi@mathmlpass{\gamma}
\msi@mathmlpass{\iota}
\msi@mathmlpass{\kappa}
\msi@mathmlpass{\lambda}
\msi@mathmlpass{\mu}
\msi@mathmlpass{\nu}
\msi@mathmlpass{\omega}
\msi@mathmlpass{\phi}
\msi@mathmlpass{\pi}
\msi@mathmlpass{\psi}
\msi@mathmlpass{\rho}
\msi@mathmlpass{\sigma}
\msi@mathmlpass{\tau}
\msi@mathmlpass{\theta}
\msi@mathmlpass{\upsilon}
\msi@mathmlpass{\varepsilon}
\msi@mathmlpass{\varkappa}
\msi@mathmlpass{\varphi}
\msi@mathmlpass{\varpi}
\msi@mathmlpass{\varrho}
\msi@mathmlpass{\varsigma}
\msi@mathmlpass{\vartheta}
\msi@mathmlpass{\xi}
\msi@mathmlpass{\zeta}



% Uppercase Greek

\msi@mathmlpass{\Delta}
\msi@mathmlpass{\digamma}
\msi@mathmlpass{\Gamma}
\msi@mathmlpass{\Lambda}
\msi@mathmlpass{\Omega}
\msi@mathmlpass{\Phi}
\msi@mathmlpass{\Pi}
\msi@mathmlpass{\Psi}
\msi@mathmlpass{\Sigma}
\msi@mathmlpass{\Theta}
\msi@mathmlpass{\Upsilon}
\msi@mathmlpass{\Xi}

% Binary Operations

\msi@mathmlpass{\amalg}
\msi@mathmlpass{\And}
\msi@mathmlpass{\ast}
\msi@mathmlpass{\bullet}
\msi@mathmlpass{\bigcirc}
\msi@mathmlpass{\barwedge}
\msi@mathmlpass{\bigtriangledown}
\msi@mathmlpass{\bigtriangleup}
\msi@mathmlpass{\boxplus}
\msi@mathmlpass{\boxminus}
\msi@mathmlpass{\boxtimes}
\msi@mathmlpass{\boxdot}
\msi@mathmlpass{\cdot}
\msi@mathmlpass{\cup}
\msi@mathmlpass{\cap}
\msi@mathmlpass{\circ}
\msi@mathmlpass{\circledast}
\msi@mathmlpass{\circledcirc}
\msi@mathmlpass{\Cup}
\msi@mathmlpass{\Cap}
\msi@mathmlpass{\curlyvee}
\msi@mathmlpass{\curlywedge}
\msi@mathmlpass{\circleddash}
\msi@mathmlpass{\centerdot}
\msi@mathmlpass{\div}
\msi@mathmlpass{\doublebarwedge}
\msi@mathmlpass{\diamond}
\msi@mathmlpass{\dagger}
\msi@mathmlpass{\ddagger}
\msi@mathmlpass{\dotplus}
\msi@mathmlpass{\divideontimes}
\msi@mathmlpass{\intercal}
\msi@mathmlpass{\leftthreetimes}
\msi@mathmlpass{\lhd}
\msi@mathmlpass{\ltimes}
\msi@mathmlpass{\mp} 
\msi@mathmlpass{\oplus}
\msi@mathmlpass{\odot}
\msi@mathmlpass{\oslash}
\msi@mathmlpass{\otimes}
\msi@mathmlpass{\ominus}
\msi@mathmlpass{\pm}
\msi@mathmlpass{\rhd}
\msi@mathmlpass{\rightthreetimes}
\msi@mathmlpass{\rtimes}   
\msi@mathmlpass{\sqcup}
\msi@mathmlpass{\sqcap}
\msi@mathmlpass{\setminus}
\msi@mathmlpass{\smallsetminus}
\msi@mathmlpass{\smallint}
\msi@mathmlpass{\star}
\msi@mathmlpass{\times}
\msi@mathmlpass{\triangleleft}
\msi@mathmlpass{\triangleright}
\msi@mathmlpass{\uplus}
\msi@mathmlpass{\unlhd}
\msi@mathmlpass{\unrhd}
\msi@mathmlpass{\vee}
\msi@mathmlpass{\veebar}
\msi@mathmlpass{\wedge}
\msi@mathmlpass{\wr}



%\msi@mathmlpass{\}
%\msi@mathmlpass{\}
%\msi@mathmlpass{\}


% Binary Relations

\msi@mathmlpass{\leq}
\msi@mathmlpass{\prec}
\msi@mathmlpass{\preceq}
\msi@mathmlpass{\ll}
\msi@mathmlpass{\subset}
\msi@mathmlpass{\subseteq}
\msi@mathmlpass{\sqsubset}
\msi@mathmlpass{\sqsubseteq}
\msi@mathmlpass{\in}
\msi@mathmlpass{\vdash}
\msi@mathmlpass{\smile}
\msi@mathmlpass{\frown}
\msi@mathmlpass{\equiv}
\msi@mathmlpass{\sim}
\msi@mathmlpass{\simeq}
\msi@mathmlpass{\asymp}
\msi@mathmlpass{\approx}
\msi@mathmlpass{\geq}
\msi@mathmlpass{\succ}
\msi@mathmlpass{\succeq}
\msi@mathmlpass{\gg}
\msi@mathmlpass{\supset}
\msi@mathmlpass{\supseteq}
\msi@mathmlpass{\sqsupset}
\msi@mathmlpass{\sqsupseteq}
\msi@mathmlpass{\ni}
\msi@mathmlpass{\dashv}
\msi@mathmlpass{\mid}
\msi@mathmlpass{\parallel}
\msi@mathmlpass{\perp}
\msi@mathmlpass{\cong}
\msi@mathmlpass{\bowtie}
\msi@mathmlpass{\propto}
\msi@mathmlpass{\models}
\msi@mathmlpass{\doteq}
\msi@mathmlpass{\Join}
\msi@mathmlpass{\Vdash}
\msi@mathmlpass{\Vvdash}
\msi@mathmlpass{\vDash}
\msi@mathmlpass{\circeq}
\msi@mathmlpass{\succsim}
\msi@mathmlpass{\gtrsim}
\msi@mathmlpass{\gtrapprox}
\msi@mathmlpass{\therefore}
\msi@mathmlpass{\because}
\msi@mathmlpass{\doteqdot}
\msi@mathmlpass{\triangleq}
\msi@mathmlpass{\precsim}
\msi@mathmlpass{\lesssim}
\msi@mathmlpass{\lessapprox}
\msi@mathmlpass{\eqslantless}
\msi@mathmlpass{\eqslantgtr}
\msi@mathmlpass{\curlyeqprec}
\msi@mathmlpass{\curlyeqsucc}
\msi@mathmlpass{\preccurlyeq}
\msi@mathmlpass{\leqq}
\msi@mathmlpass{\leqslant}
\msi@mathmlpass{\lessgtr}
\msi@mathmlpass{\risingdotseq}
\msi@mathmlpass{\fallingdotseq}
\msi@mathmlpass{\succcurlyeq}
\msi@mathmlpass{\geqq}
\msi@mathmlpass{\geqslant}
\msi@mathmlpass{\gtrless}
\msi@mathmlpass{\vartriangleright}
\msi@mathmlpass{\vartriangleleft}
\msi@mathmlpass{\trianglerighteq}
\msi@mathmlpass{\trianglelefteq}
\msi@mathmlpass{\between}
\msi@mathmlpass{\blacktriangleright}
\msi@mathmlpass{\blacktriangleleft}
\msi@mathmlpass{\eqcirc}
\msi@mathmlpass{\lesseqgtr}
\msi@mathmlpass{\gtreqless}
\msi@mathmlpass{\lesseqqgtr}
\msi@mathmlpass{\gtreqqless}
\msi@mathmlpass{\varpropto}
\msi@mathmlpass{\eqcirc}
\msi@mathmlpass{\smallfrown}
\msi@mathmlpass{\Subset}
\msi@mathmlpass{\Supset}
\msi@mathmlpass{\subseteqq}
\msi@mathmlpass{\supseteqq}
\msi@mathmlpass{\bumpeq}
\msi@mathmlpass{\Bumpeq}
\msi@mathmlpass{\lll}
\msi@mathmlpass{\ggg}
\msi@mathmlpass{\pitchfork}
\msi@mathmlpass{\backsim}
\msi@mathmlpass{\backsimeq}
\msi@mathmlpass{\eqsim}
\msi@mathmlpass{\lessdot}
\msi@mathmlpass{\gtrdot}
\msi@mathmlpass{\shortmid}
\msi@mathmlpass{\shortparallel}
\msi@mathmlpass{\thicksim}
\msi@mathmlpass{\thickapprox}
\msi@mathmlpass{\approxeq}
\msi@mathmlpass{\succapprox}
\msi@mathmlpass{\precapprox}
\msi@mathmlpass{\backepsilon}
\msi@mathmlpass{\vartriangle}


% Negated relations

\msi@mathmlpass{\neq}
\msi@mathmlpass{\notin}
\msi@mathmlpass{\lvertneqq}
\msi@mathmlpass{\gvertneqq}
\msi@mathmlpass{\nleq}
\msi@mathmlpass{\ngeq}
\msi@mathmlpass{\nless}
\msi@mathmlpass{\ngtr}
\msi@mathmlpass{\nprec}
\msi@mathmlpass{\nsucc}
\msi@mathmlpass{\lneqq}
\msi@mathmlpass{\gneqq}
\msi@mathmlpass{\nleqslant}
\msi@mathmlpass{\ngeqslant}
\msi@mathmlpass{\lneq}
\msi@mathmlpass{\gneq}
\msi@mathmlpass{\npreceq}
\msi@mathmlpass{\nsucceq}
\msi@mathmlpass{\precnsim}
\msi@mathmlpass{\succnsim}
\msi@mathmlpass{\lnsim}
\msi@mathmlpass{\gnsim}
\msi@mathmlpass{\nleqq}
\msi@mathmlpass{\ngeqq}
\msi@mathmlpass{\precneqq}
\msi@mathmlpass{\succneqq}
\msi@mathmlpass{\precnapprox}
\msi@mathmlpass{\succnapprox}
\msi@mathmlpass{\lnapprox}
\msi@mathmlpass{\gnapprox}
\msi@mathmlpass{\nsim}
\msi@mathmlpass{\ncong}
\msi@mathmlpass{\varsubsetneq}
\msi@mathmlpass{\varsupsetneq}
\msi@mathmlpass{\nsubseteqq}
\msi@mathmlpass{\nsupseteqq}
\msi@mathmlpass{\subsetneqq}
\msi@mathmlpass{\supsetneqq}
\msi@mathmlpass{\varsubsetneqq}
\msi@mathmlpass{\varsupsetneqq}
\msi@mathmlpass{\subsetneq}
\msi@mathmlpass{\supsetneq}
\msi@mathmlpass{\nsubseteq}
\msi@mathmlpass{\nsupseteq}
\msi@mathmlpass{\nparallel}
\msi@mathmlpass{\nmid}
\msi@mathmlpass{\nshortmid}
\msi@mathmlpass{\nshortparallel}
\msi@mathmlpass{\nvdash}
\msi@mathmlpass{\nVdash}
\msi@mathmlpass{\nvDash}
\msi@mathmlpass{\nVDash}
\msi@mathmlpass{\ntrianglerighteq}
\msi@mathmlpass{\ntrianglelefteq}
\msi@mathmlpass{\ntriangleright}
\msi@mathmlpass{\ntriangleleft}
\msi@mathmlpass{\nleftarrow}
\msi@mathmlpass{\nrightarrow}
\msi@mathmlpass{\nLeftarrow}
\msi@mathmlpass{\nRightarrow}
\msi@mathmlpass{\nLeftrightarrow}
\msi@mathmlpass{\nleftrightarrow}


%Arrows
\msi@mathmlpass{\leftarrow}
\msi@mathmlpass{\Leftarrow}
\msi@mathmlpass{\rightarrow}
\msi@mathmlpass{\Rightarrow}
\msi@mathmlpass{\leftrightarrow}
\msi@mathmlpass{\Leftrightarrow}
\msi@mathmlpass{\mapsto}
\msi@mathmlpass{\hookleftarrow}
\msi@mathmlpass{\leftharpoonup}
\msi@mathmlpass{\leftharpoondown}
\msi@mathmlpass{\uparrow}
\msi@mathmlpass{\Uparrow}
\msi@mathmlpass{\downarrow}
\msi@mathmlpass{\Downarrow}
\msi@mathmlpass{\updownarrow}
\msi@mathmlpass{\longleftarrow}
\msi@mathmlpass{\Longleftarrow}
\msi@mathmlpass{\longrightarrow}
\msi@mathmlpass{\Longrightarrow}
\msi@mathmlpass{\longleftrightarrow}
\msi@mathmlpass{\Longleftrightarrow}
\msi@mathmlpass{\longmapsto}
\msi@mathmlpass{\hookrightarrow}
\msi@mathmlpass{\rightharpoonup}
\msi@mathmlpass{\rightharpoondown}
\msi@mathmlpass{\leadsto}
\msi@mathmlpass{\Updownarrow}
\msi@mathmlpass{\nearrow}
\msi@mathmlpass{\searrow}
\msi@mathmlpass{\swarrow}
\msi@mathmlpass{\nwarrow}
\msi@mathmlpass{\circlearrowright}
\msi@mathmlpass{\circlearrowleft}
\msi@mathmlpass{\rightleftharpoons}
\msi@mathmlpass{\leftrightharpoons}
\msi@mathmlpass{\twoheadrightarrow}
\msi@mathmlpass{\twoheadleftarrow}
\msi@mathmlpass{\leftleftarrows}
\msi@mathmlpass{\rightrightarrows}
\msi@mathmlpass{\upuparrows}
\msi@mathmlpass{\downdownarrows}
\msi@mathmlpass{\upharpoonright}
\msi@mathmlpass{\downharpoonright}
\msi@mathmlpass{\upharpoonleft}
\msi@mathmlpass{\downharpoonleft}
\msi@mathmlpass{\rightarrowtail}
\msi@mathmlpass{\leftarrowtail}
\msi@mathmlpass{\leftrightarrows}
\msi@mathmlpass{\rightleftarrows}
\msi@mathmlpass{\Lsh}
\msi@mathmlpass{\Rsh}
\msi@mathmlpass{\rightsquigarrow}
\msi@mathmlpass{\leftrightsquigarrow}
\msi@mathmlpass{\looparrowleft}
\msi@mathmlpass{\looparrowright}
\msi@mathmlpass{\multimap}
\msi@mathmlpass{\Rrightarrow}
\msi@mathmlpass{\Lleftarrow}
\msi@mathmlpass{\curvearrowleft}
\msi@mathmlpass{\curvearrowright}
\msi@mathmlpass{\dashrightarrow}
\msi@mathmlpass{\dashleftarrow}
\msi@mathmlpass{\implies}
\msi@mathmlpass{\impliedby}
\msi@mathmlpass{\iff}


%Miscellaneous

\msi@mathmlpass{\infty}
\msi@mathmlpass{\partial}
\msi@mathmlpass{\ldots}
\msi@mathmlpass{\cdots}
\msi@mathmlpass{\vdots}
\msi@mathmlpass{\ddots}
%\msi@mathmlpass{\i}
%\msi@mathmlpass{\j}
\msi@mathmlpass{\ell}
\msi@mathmlpass{\wp}
\msi@mathmlpass{\hbar}
\msi@mathmlpass{\hslash}
\msi@mathmlpass{\forall}
\msi@mathmlpass{\exists}
\msi@mathmlpass{\nexists}
\msi@mathmlpass{\Re}
\msi@mathmlpass{\Im}
\msi@mathmlpass{\aleph}
\msi@mathmlpass{\prime}
\msi@mathmlpass{\backprime}
\msi@mathmlpass{\emptyset}
\msi@mathmlpass{\varnothing}
\msi@mathmlpass{\diagup}
\msi@mathmlpass{\diagdown}
\msi@mathmlpass{\nabla}
\msi@mathmlpass{\surd}
\msi@mathmlpass{\top}
\msi@mathmlpass{\bot}
\msi@mathmlpass{\eth}
\msi@mathmlpass{\lambdabar}
\msi@mathmlpass{\angle}
\msi@mathmlpass{\measuredangle}
\msi@mathmlpass{\sphericalangle}
\msi@mathmlpass{\circledS}
\msi@mathmlpass{\tciLaplace}
\msi@mathmlpass{\tciFourier}
\msi@mathmlpass{\lnot}
\msi@mathmlpass{\complement}
\msi@mathmlpass{\Finv}
\msi@mathmlpass{\Game}
\msi@mathmlpass{\bigstar}
\msi@mathmlpass{\Vert}
\msi@mathmlpass{\square}
\msi@mathmlpass{\blacksquare}
\msi@mathmlpass{\Diamond}
\msi@mathmlpass{\lozenge}
\msi@mathmlpass{\blacklozenge}
\msi@mathmlpass{\triangle}
\msi@mathmlpass{\blacktriangle}
\msi@mathmlpass{\triangledown}
\msi@mathmlpass{\blacktriangledown}
\msi@mathmlpass{\dag}
\msi@mathmlpass{\ddag}
\msi@mathmlpass{\beth}
\msi@mathmlpass{\gimel}
\msi@mathmlpass{\daleth}
\msi@mathmlpass{\sharp}
\msi@mathmlpass{\flat}
\msi@mathmlpass{\natural}
\msi@mathmlpass{\clubsuit}
\msi@mathmlpass{\diamondsuit}
\msi@mathmlpass{\heartsuit}
\msi@mathmlpass{\spadesuit}
\msi@mathmlpass{\checkmark}
\msi@mathmlpass{\maltese}
\msi@mathmlpass{\Bbbk}
\msi@mathmlpass{\cents}
\msi@mathmlpass{\pounds}
\msi@mathmlpass{\textcurrency}
\msi@mathmlpass{\yen}
\msi@mathmlpass{\euro}
\msi@mathmlpass{\textfranc}
\msi@mathmlpass{\textlira}
\msi@mathmlpass{\textpeseta}
\msi@mathmlpass{\texttrademark}
\msi@mathmlpass{\mho}
\msi@mathmlpass{\colon}

% Delimiters

\msi@mathmlpass{\lfloor}
\msi@mathmlpass{\rfloor}
\msi@mathmlpass{\lceil}
\msi@mathmlpass{\rceil}
\msi@mathmlpass{\langle}
\msi@mathmlpass{\rangle}
\msi@mathmlpass{\ulcorner}
\msi@mathmlpass{\urcorner}
\msi@mathmlpass{\llcorner}
\msi@mathmlpass{\lrcorner}


\def\TEXTsymbol#1{%
  \ifmmode
    \temptoksa={\TEXTsymbol{#1}}%
    \the\temptoksa
  \else
    #1%
  \fi
}

\def\backslash{\@hex{5c}}

%\def\textendash{\@hex{e28093}}
%\def\textemdash{\@hex{e28094}}

\def\textemdash{\@hex{2014}}



{\catcode`\$=11\relax
 \gdef\${\char`\$}
}


\def\/{\msitag{<italic-correction/>}}

\def\@hex#1{\char38\char35x#1;}

\def\@accent#1#2{%
  \ifx#1\i
    \csname dotlessi-#2\endcsname
  \else\ifx#1\j
    \csname dotlessj-#2\endcsname
  \else 
    \csname #1-#2\endcsname
  \fi\fi\fi
}

\def\`#1{\@accent{#1}{grave}}

\def\'#1{\@accent{#1}{acute}}

\def\~#1{\@accent{#1}{tilde}}

\def\^#1{\@accent{#1}{caret}}

\def\=#1{\@accent{#1}{bar}}

\def\"#1{\@accent{#1}{umlat}}

\def\c#1{\@accent{#1}{ced}}

\def\.#1{\@accent{#1}{dot}}

\def\r#1{\@accent{#1}{r}}


%% \'{\^{e}}

\def\msi@uni#1#2{\@namedef{#1}{\@hex{#2}}}



\msi@uni{i}{131} %dotless i
\msi@uni{j}{132} %dotless j

\msi@uni{A-grave}{c0}
\msi@uni{a-grave}{e0}

\msi@uni{DH}{d0}
\msi@uni{dh}{f0}

\msi@uni{textexclamdown}{a1}

\msi@uni{A-acute}{c1}
\msi@uni{N-tilde}{d1}
\msi@uni{a-acute}{e1}
\msi@uni{n-tilde}{f1}

\msi@uni{cents}{a2}


\msi@uni{A-caret}{c2}
\msi@uni{O-grave}{d2}
\msi@uni{a-caret}{e2}
\msi@uni{o-grave}{f2}

\msi@uni{pounds}{a3}

\msi@uni{A-tilde}{c3}
\msi@uni{O-acute}{d3}
\msi@uni{a-tilde}{e3}
\msi@uni{o-acute}{f3}


\msi@uni{textcurrency}{a4}

\msi@uni{-acute}{b4}
\msi@uni{A-umlat}{c4}
\msi@uni{O-caret}{d4}
\msi@uni{a-umlat}{e4}
\msi@uni{o-caret}{f4}


\msi@uni{yen}{a5}

\msi@uni{AA}{c5}

\msi@uni{O-tilde}{d5}
\msi@uni{aa}{e5}
\msi@uni{o-tilde}{f5}

\msi@uni{P}{b6}
\msi@uni{AE}{c6}
\msi@uni{O-umlat}{d6}
\msi@uni{ae}{e6}
\msi@uni{o-umlat}{f6}

\msi@uni{S}{a7}
\msi@uni{textperiodcentered}{b7}
\msi@uni{C-ced}{c7}
\msi@uni{c-ced}{e7}

\msi@uni{-umlat}{a8}
\msi@uni{-ced}{b8}
\msi@uni{E-grave}{c8}

\msi@uni{O}{d8}
\msi@uni{e-grave}{e8}
\msi@uni{o}{f8}


\msi@uni{copyright}{a9}

\msi@uni{E-acute}{c9}
\msi@uni{U-grave}{d9}
\msi@uni{e-acute}{e9}
\msi@uni{u-grave}{f9}
\msi@uni{E-caret}{ca}
\msi@uni{U-acute}{da}
\msi@uni{e-caret}{ea}
\msi@uni{u-acute}{fa}


\msi@uni{guillemotleft}{ab}
\msi@uni{guillemotright}{bb}

\msi@uni{E-umlat}{cb}
\msi@uni{U-caret}{db}
\msi@uni{e-umlat}{eb}
\msi@uni{u-caret}{fb}
\msi@uni{I-grave}{cc}
\msi@uni{U-umlat}{dc}

\msi@uni{dotlessi-grave}{ec}

\msi@uni{u-umlat}{fc}
\msi@uni{I-acute}{cd}
\msi@uni{Y-acute}{dd}
\msi@uni{dotlessi-acute}{ed}
\msi@uni{y-acute}{fd}

\msi@uni{registered}{ae}
\msi@uni{I-caret}{ce}
\msi@uni{TH}{de}
\msi@uni{dotlessi-caret}{ee}
\msi@uni{th}{fe}

\msi@uni{-bar}{af}
\msi@uni{textquestiondown}{bf}

\msi@uni{I-umlat}{cf}
\msi@uni{ss}{df}
\msi@uni{dotlessi-umlat}{ef}
\msi@uni{y-umlat}{ff}


%%%% Latin-extended
%%%
\msi@uni{A-bar}{100}
\msi@uni{a-bar}{101}
\msi@uni{G-dot}{120}
\msi@uni{g-dot}{121}
\msi@uni{I-dot}{130}
\msi@uni{E-bar}{112}
\msi@uni{e-bar}{113}
\msi@uni{E-dot}{116}
\msi@uni{e-dot}{117}
\msi@uni{G-ced}{122}
\msi@uni{g-ced}{123}
\msi@uni{T-ced}{162}
\msi@uni{t-ced}{163}
\msi@uni{N-ced}{145}
\msi@uni{n-ced}{146}
\msi@uni{K-ced}{136}
\msi@uni{k-ced}{137}
\msi@uni{R-ced}{156}
\msi@uni{Y-caret}{176}
\msi@uni{y-caret}{177}
\msi@uni{N-v}{147}
\msi@uni{r-ced}{157}
\msi@uni{E-k}{118}
\msi@uni{I-tilde}{128}
\msi@uni{n-v}{148}
\msi@uni{R-v}{158}
\msi@uni{U-tilde}{168}





\msi@uni{C-acute}{106}
\msi@uni{c-acute}{107}
\msi@uni{N-acute}{143}
\msi@uni{n-acute}{144}
\msi@uni{H-caret}{124}
\msi@uni{h-caret}{125}
\msi@uni{J-caret}{134}
\msi@uni{j-caret}{[[j-caret?]]}
\msi@uni{C-caret}{108}
\msi@uni{c-caret}{109}
\msi@uni{C-dot}{10a}
\msi@uni{c-dot}{10b}

\msi@uni{R-acute}{154}
\msi@uni{r-acute}{155}
\msi@uni{W-caret}{174}
\msi@uni{w-caret}{175}
\msi@uni{Y-umlat}{178}

%%\msi@uni{dotlessj-caret}{[[dotless j caret]]}


\def\H#1{\@accent{#1}{H}}
\def\v#1{\@accent{#1}{v}}
\def\u#1{\@accent{#1}{u}}


 
\msi@uni{O-H}{150}
\msi@uni{U-H}{170}
\msi@uni{o-H}{151}
\msi@uni{u-H}{171}

\msi@uni{S-v}{160}
\msi@uni{s-v}{161}
\msi@uni{T-v}{164}
\msi@uni{t-v}{165}

\msi@uni{A-u}{102}
\msi@uni{a-u}{103}
\msi@uni{E-u}{114}
\msi@uni{e-u}{115}


\def\k#1{\@accent{#1}{k}}

\msi@uni{A-k}{104}
\msi@uni{a-k}{105}
\msi@uni{U-k}{172}
\msi@uni{u-k}{173}
\msi@uni{e-k}{119}
\msi@uni{dotlessi-tilde}{129}
\msi@uni{L-acute}{139}
\msi@uni{r-v}{159}
\msi@uni{u-tilde}{169}
\msi@uni{Z-acute}{179}

\msi@uni{E-v}{11a}
\msi@uni{I-bar}{12a}
\msi@uni{l-acute}{13a}
\msi@uni{S-acute}{15a}
\msi@uni{U-bar}{16a}
\msi@uni{z-acute}{17a}

\msi@uni{e-v}{11b}
\msi@uni{dotlessi-bar}{12b}
\msi@uni{L-ced}{13b}
\msi@uni{s-acute}{15b}
\msi@uni{u-bar}{16b}
\msi@uni{Z-dot}{17b}

\msi@uni{C-v}{10c}
\msi@uni{G-caret}{11c}
\msi@uni{I-u}{12c}
\msi@uni{l-ced}{13c}
\msi@uni{O-bar}{14c}
\msi@uni{S-caret}{15c}
\msi@uni{U-u}{16c}
\msi@uni{z-dot}{17c}

\msi@uni{c-v}{10d}
\msi@uni{g-caret}{11d}
\msi@uni{dotlessi-u}{12d}
\msi@uni{L-v}{13d}
\msi@uni{o-bar}{14d}
\msi@uni{s-caret}{15d}
\msi@uni{u-u}{16d}
\msi@uni{Z-v}{17d}

\msi@uni{D-v}{10e}
\msi@uni{G-u}{11e}
\msi@uni{I-k}{12e}
\msi@uni{l-v}{13e}
\msi@uni{O-u}{14e}
\msi@uni{S-ced}{15e}
\msi@uni{z-v}{17e}


\msi@uni{d-v}{10f}
\msi@uni{g-u}{11f}
\msi@uni{i-k}{12f}
\msi@uni{o-u}{14f}
\msi@uni{s-ced}{15f}


\msi@uni{L}{141}
\msi@uni{l}{142}
\msi@uni{NG}{14a}
\msi@uni{ng}{14b}
\msi@uni{DJ}{110}
\msi@uni{dj}{111}
\msi@uni{OE}{152}
\msi@uni{oe}{153}

\msi@uni{U-r}{16e}
\msi@uni{u-r}{16f}

\msi@uni{guilsinglleft}{2039}
\msi@uni{guilsinglright}{203a}

%% Spacing


\def\qquad{%
   \ifmmode
      \msitag{\qquad}%
   \else
      \msihmode\msitag{<hspace dim="2em" type="twoEmSpace">}\@hex{2001}\msitag{</hspace>}%
   \fi
}

\def\quad{%
   \ifmmode
     \msitag{\quad}%
   \else
     \msihmode\msitag{<hspace dim="1em" type="emSpace">}\@hex{2003}\msitag{</hspace>}%
   \fi
}

\def\ {\msihmode{ }}
\def~{\msihmode\msitag{<hspace type="nonBreakingSpace">}\@hex{a0}\msitag{</hspace>}}
\def\/{\msihmode\msitag{<hspace dim="0.083en" type="italicCorrectionSpace">}\@hex{200a}\msitag{</hspace>}}

\bgroup
  \catcode`\%=12
  \gdef\strut{\msitag{<vspace lineHt="100%" type="strut"/>}}
\egroup


\def\noindent{\par\msitag{<hspace dim="0.0em" type="noIndent"></hspace><requestimplementation>noindent</requestimplementation>}}


\def\thinspace{%
   \ifmmode
      \string\thinspace
   \else
      \msihmode\msitag{<hspace dim="0.17em" type="thinSpace">}\@hex{2009}\msitag{</hspace>}%
   \fi
}

\def\thickspace{%
   \ifmmode
      \string\thickspace
   \else
      \msihmode\msitag{<hspace dim="0.5em" type="thickSpace">}\@hex{2002}\msitag{</hspace>}%
   \fi
}


\def\negthinspace{%
   \ifmmode
      \string\negthinspace
   \else
      \msihmode\msitag{<hspace dim="0.0em" type="negativeThinSpace"></hspace>}%
   \fi
}







\def\out@hrulefill{%
   <hspace fillWith="line" flex="1" class="stretchySpace" type="stretchySpace"></hspace>}


\msi@rfi{\newpage}{\newpage}
\msi@rfi{\msi@hook@hfil}{\hfil}
\msi@rfi{\msi@hook@hfill}{\hfill}

\msi@rfi{\msi@hook@vfil}{\vfil}
\msi@rfi{\msi@hook@vfill}{\vfill}

%%\def\msi@hook@hss{\msitag{\hss}}
%%\def\msi@hook@vss{\msitag{\vss}}






\def\label#1{%
   \ifmmode
      \string\label\@brace{#1}%
   \else
      \msihmode\msitag{<marker id="#1"/>}%
   \fi
}

\def\frac#1#2{\string\frac\@brace{#1}\@brace{#2}}
\def\dfrac#1#2{\string\dfrac\@brace{#1}\@brace{#2}}

\def\unit#1{\string\unit\@brace{#1}}

\def\mathbf#1{\string\mathbf\@brace{#1}}
\def\mathit#1{\string\mathit\@brace{#1}}
\def\mathsf#1{\string\mathsf\@brace{#1}}
\def\mathtt#1{\string\mathtt\@brace{#1}}
\def\mathrm#1{\string\mathrm\@brace{#1}}



\msi@mathmlpass{\lim}

\def\func#1{\string\func\@brace{#1}}
\def\limfunc#1{\string\limfunc\@brace{#1}}


\def\sqrt{%
  \@ifnextchar[%
    {\@nthroot}%
    {\@sqrt}}

\def\@sqrt#1{%
   \string\sqrt\@brace{#1}%
}

\def\@nthroot[#1]#2{%
   \string\sqrt[#1]\@brace{#2}%
}

\msi@mathmlpass{\vert}
\msi@mathmlpass{\Vert}



\msi@mathmlpass{\blacktriangleright}
\msi@mathmlpass{\max}
\msi@mathmlpass{\min}
\msi@mathmlpass{\prime}


%\msi@mathmlpass{\thinspace}



\def\mathpass@arg#1{%
  \def#1##1{\string#1\@brace{##1}}
}

\def\mathpass@arg@arg#1{%
  \def#1##1##2{\string#1\@brace{##1}\@brace{##2}}
}
\def\mathpass@arg@arg@arg#1{%
  \def#1##1##2##3{\string#1\@brace{##1}\@brace{##2}\@brace{##3}}
}
\def\mathpass@arg@arg@arg@arg#1{%
  \def#1##1##2##3##4{\string#1\@brace{##1}\@brace{##2}\@brace{##3}\@brace{##4}}
}

\def\mathpass@arg@arg@arg@arg@arg#1{%
  \def#1##1##2##3##4##5{\string#1\@brace{##1}\@brace{##2}\@brace{##3}\@brace{##4}\@brace{##5}}
}



\mathpass@arg{\tag}


\mathpass@arg{\mathbb}
\mathpass@arg{\mathcal}


\mathpass@arg@arg{\binom}
\mathpass@arg@arg{\dbinom}
\mathpass@arg@arg{\tbinom}

\mathpass@arg@arg{\QATOP}
\mathpass@arg@arg{\QTATOP}
\mathpass@arg@arg{\QDATOP}

\mathpass@arg@arg@arg{\QABOVE}
\mathpass@arg@arg@arg{\QTABOVE}
\mathpass@arg@arg@arg{\QDABOVE}
\mathpass@arg@arg@arg@arg{\QOVERD}
\mathpass@arg@arg@arg@arg{\QTOVERD}
\mathpass@arg@arg@arg@arg{\QDOVERD}
\mathpass@arg@arg@arg@arg{\QATOPD}
\mathpass@arg@arg@arg{\QTATOPD}
\mathpass@arg@arg@arg{\QDATOPD}
%  \mathpass@arg@arg@arg{}
%  \mathpass@arg@arg@arg{}
%  \mathpass@arg@arg@arg{}
%  


\msi@mathmlpass{\QABOVED}
%\def\QABOVED#1#2#3#4#5{{#4 \abovewithdelims#1#2#3 #5}}%
%  \def\QTABOVED#1#2#3#4#5{{\textstyle 
%     {#4 \abovewithdelims#1#2#3 #5}}}%
%  \def\QDABOVED#1#2#3#4#5{{\displaystyle 
%     {#4 \abovewithdelims#1#2#3 #5}}}%
%  

\def\unit#1{\string\unit\@brace{#1}}


\msi@mathmlpass{\left}
\msi@mathmlpass{\right}
\msi@mathmlpass{\in}
\msi@mathmlpass{\overset}
\msi@mathmlpass{\underset}
\msi@mathmlpass{\sinh}
\msi@mathmlpass{\cosh}
\msi@mathmlpass{\tanh}
\msi@mathmlpass{\coth}
\msi@mathmlpass{\exp}
\msi@mathmlpass{\mathstrut}

\def\text#1{\msitag{\text{#1}}}

\def\vspace#1{%
   \ifmmode
     \string\vspace\@brace{#1}%
   \else
     \msitag{<vspace dim="#1" type="customSpace"></vspace>}%
   \fi
}



%%\def\msi@textsmall#1{\msiopentag{<small>}#1\msiclosetag{</small>}}

\def\emph#1{\msiopentag{em}{<em>}#1\msiclosetag{em}{</em>}}


\def\&{\char`\&amp;}

\def\out@hyperref#1#2#3#4{%
   \msiopentag{a}{<a href="#4">}#1\msiclosetag{a}{</a>}
}

\newif\if@in@texttag
\@in@texttagfalse

\def\QTP#1{%
  \par
  \msihmode
  \msiopentag{QTP}{<QTP type="#1">}%
  \begingroup
    \def\par{\msiclosetag{QTP}{</QTP>}\endgroup}%
}

\def\@ttclose#1{\msiclosetag{#1}{</#1>}}
\def\@closelasttexttag{\expandafter\@ttclose\expandafter{\@lasttexttag}}



\def\@text@tag#1{%
   \expandafter\def\csname#1\endcsname{%
      \msihmode
      \if@in@texttag
         \expandafter\@ttclose\expandafter{\@lasttexttag}%
      \else
         \@in@texttagtrue
      \fi
      \gdef\@lasttexttag{#1}%
      \msiopentag{#1}{<#1>}%
      \aftergroup\@closelasttexttag
   }
}

%% Various note type things

\def\@start@notewrapper{%
    \msiopentag{notewrapper}{<notewrapper xmlns="http://www.w3.org/1999/xhtml">}}

\def\@end@notewrapper{%
    \msiclosetag{notewrapper}{</notewrapper>}}

\def\@end@footnote{\msiclosetag{note}{</note>}\@end@notewrapper}
\def\@innote{\bgroup\aftergroup\@end@footnote}


\def\footnote{%
    \br\@start@notewrapper
    \msiopentag{note}{<note type="footnote">}
    \afterassignment\@footnoteb
    \let\junk
}
\def\@footnoteb{
    \bgroup
    \aftergroup\@footnotec
}

\def\@footnotec{
    \msiclosetag{note}{</note>}%
    \@end@notewrapper}

\def\out@CustomNoteA[#1]#2#3{%
    \msiopentag{notewrapper}{<notewrapper xmlns="http://www.w3.org/1999/xhtml">}%
    \msiopentag{note}{<note type="#2">}%
    \bgroup
      \@in@texttagfalse% turn this off so we don't close pending tags if we nest a font switch. 
      #3%
    \egroup
    \msiclosetag{note}{</note>}%
    \msiclosetag{notewrapper}{</notewrapper>}%
}

\def\out@CustomNoteB#1#2{%
    \msiopentag{notewrapper}{<notewrapper xmlns="http://www.w3.org/1999/xhtml">}%
    \msiopentag{note}{<note type="#1">}%
    \bgroup
      \@in@texttagfalse% turn this off so we don't close pending tags if we nest a font switch. 
      #2%
    \egroup
    \msiclosetag{note}{</note>}%
    \msiclosetag{notewrapper}{</notewrapper>}%
}



%% \def\msi@opendocument{%
%%    \msitag{<?xml version="1.0"?>}\br
%%    
%%    \msitag{<!DOCTYPE swxml PUBLIC
%%      "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN"
%%      "http://www.w3.org/TR/MathML2/dtd/xhtml-math11-f.dtd"
%%      [
%%       <!ATTLIST maction id ID ##IMPLIED>
%%       <!ENTITY mathml "http://www.w3.org/1998/Math/MathML">
%%      ]>}\br
%%    
%%    \msitag{<?xml-stylesheet href="StandardLaTeXArticle.css" type="text/css"?>}\br
%%    \msiopentag{document}{<document xmlns:sw="http://www.sciword.com/namespaces/sciword" xmlns:mml="http://www.w3.org/1998/Math/MathML" type="latex">}\br
%%    \msiopentag{preamble}{<preamble>}
%% }

%% Temporary until prince can read xml

\def\msi@opendocument{%
   \msitag{<?xml version="1.0"?>}\br
   \msitag{<?xml-stylesheet href="css/my.css" type="text/css"?>}\br
   \msitag{<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1 plus MathML 2.0//EN" "http://www.w3.org/TR/MathML2/dtd/xhtml-math11-f.dtd">}
   
  \br\msitag{<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:mml="http://www.w3.org/1998/Math/MathML"
      xmlns:sw="http://www.sciword.com/namespaces/sciword">}
   
   \br\msitag{<head>}
   \br\msiopentag{preamble}{<preamble>}
}



